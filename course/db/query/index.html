
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="克瑞奇（Chritch）的笔记本">
      
      
      
      
        <link rel="prev" href="../index/lsm/">
      
      
        <link rel="next" href="../transaction/">
      
      
      <link rel="icon" href="../../../images/zerokei-logo.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.13">
    
    
      
        <title>Query Processing & Optimization - 克瑞奇（Chritch）的笔记本</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=JetBrains:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"JetBrains";--md-code-font:"Fira Code"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#query-processing-optimization" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="克瑞奇（Chritch）的笔记本" class="md-header__button md-logo" aria-label="克瑞奇（Chritch）的笔记本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4h-2M3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7H3m2-2v2h2V5H5m0 14h2v-2H5v2m0-6h2v-2H5v2Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            克瑞奇（Chritch）的笔记本
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Query Processing & Optimization
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Zerokei/Notes/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  Course

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../tutorials/" class="md-tabs__link">
          
  
    
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../rec/" class="md-tabs__link">
          
  
    
  
  Recommendation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../misc/" class="md-tabs__link">
          
  
    
  
  Misc

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="克瑞奇（Chritch）的笔记本" class="md-nav__button md-logo" aria-label="克瑞奇（Chritch）的笔记本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4h-2M3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7H3m2-2v2h2V5H5m0 14h2v-2H5v2m0-6h2v-2H5v2Z"/></svg>

    </a>
    克瑞奇（Chritch）的笔记本
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Zerokei/Notes/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../.." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Home
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Course
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Course
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../crypto/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Cryptography
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Cryptography
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/Math/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数学基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/old/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    古典密码
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/md5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MD5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/SHA1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SHA-1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/rc4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    分组密码工作模式与流密码
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/DES/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DES
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/AES/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AES
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/RSA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RSA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/ECC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ECC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/final/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Crypto 考试重点
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Database System
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Database System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../sql/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Relational Model & SQL
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3_2" id="__nav_2_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_2">
            <span class="md-nav__icon md-icon"></span>
            Relational Model & SQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sql/algebra/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Relational Algebra
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sql/sql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ER/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    E-R Model and Normal Form
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database Storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../index/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Database Index
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3_5" id="__nav_2_3_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_5">
            <span class="md-nav__icon md-icon"></span>
            Database Index
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../index/Bplus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    B+ Tree
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../index/lsm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LSM Tree
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Query Processing & Optimization
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Query Processing & Optimization
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#parsing-translation" class="md-nav__link">
    <span class="md-ellipsis">
      Parsing &amp; Translation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parsing & Translation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#measures-of-query-cost" class="md-nav__link">
    <span class="md-ellipsis">
      Measures of Query Cost
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selection" class="md-nav__link">
    <span class="md-ellipsis">
      Selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-merge-sort" class="md-nav__link">
    <span class="md-ellipsis">
      External Merge Sort
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join" class="md-nav__link">
    <span class="md-ellipsis">
      Join
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Evaluation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#equivalence-rule" class="md-nav__link">
    <span class="md-ellipsis">
      Equivalence Rule(等价关系表达式)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cost-estimation" class="md-nav__link">
    <span class="md-ellipsis">
      Cost Estimation(结果集大小估计)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transaction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transaction
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../ads/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Advanced Data Structure and Algorithms
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Advanced Data Structure and Algorithms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/avl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AVL Trees
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/splay/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Splay Trees
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/rb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Red-Black Trees
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/inverse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inverted File Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/left/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Leftist Heaps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/skew/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Skew Heaps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/bin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binomial Queue
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/back/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Backtracking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/divide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Divide and Conquer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/dp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dynamic Program
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/greedy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greedy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/np/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NP Completeness
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/appr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Approximation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/local/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Local Search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/random/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Randomized Algorithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/para/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parallel Algorithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/external/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External Sorting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../tutorials/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/mkdocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MkDocs 安装记录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/rsshub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RSSHub 使用记录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/ubuntu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ubuntu22.04 安装记录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/idea/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IDEA 踩坑记录
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../rec/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Recommendation
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Recommendation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../misc/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Misc
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Misc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/verilog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Verilog 语法手册
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Art of the Readable Code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/ann/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artificial Neural Network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/schoolbus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ZJU SchoolBus Writeup
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#parsing-translation" class="md-nav__link">
    <span class="md-ellipsis">
      Parsing &amp; Translation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parsing & Translation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#measures-of-query-cost" class="md-nav__link">
    <span class="md-ellipsis">
      Measures of Query Cost
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selection" class="md-nav__link">
    <span class="md-ellipsis">
      Selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-merge-sort" class="md-nav__link">
    <span class="md-ellipsis">
      External Merge Sort
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join" class="md-nav__link">
    <span class="md-ellipsis">
      Join
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Evaluation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#equivalence-rule" class="md-nav__link">
    <span class="md-ellipsis">
      Equivalence Rule(等价关系表达式)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cost-estimation" class="md-nav__link">
    <span class="md-ellipsis">
      Cost Estimation(结果集大小估计)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="query-processing-optimization">Query Processing &amp; Optimization</h1>
<p>查询处理共分为三个过程：执行(Parsing &amp; Translation)、优化(Optimization)、估计(Evaluation)</p>
<h2 id="parsing-translation">Parsing &amp; Translation</h2>
<h3 id="measures-of-query-cost">Measures of Query Cost</h3>
<ul>
<li><span class="arithmatex">\(t_T\)</span>: time to transfer one block</li>
<li><span class="arithmatex">\(t_S\)</span>: time for one seek</li>
<li>Cost for b block transfers plus S seeks: <span class="arithmatex">\(b*t_T + S*t_S\)</span></li>
</ul>
<h3 id="selection">Selection</h3>
<ul>
<li>Linear Search(equality on key): 线性搜索<ul>
<li>worst cost: <span class="arithmatex">\(b_r * t_T + t_S\)</span> (关系表存放在<span class="arithmatex">\(b_r\)</span>个block中)</li>
<li>average cost: <span class="arithmatex">\((b_r/2)*t_T + t_S\)</span> (在查询值为主码的情况下)</li>
</ul>
</li>
<li>Primary B+-Tree index(equality on key): B+树主索引搜索<ul>
<li>Cost: <span class="arithmatex">\((h_i+1)*(t_T+t_S)\)</span>，<span class="arithmatex">\(h_i\)</span>是B+树的高度，每次需要从Disk中Seek该块并读入，而后面的1是指最后找到目标块时，需要进行seek+transfer(使用Index必不可少的)</li>
</ul>
</li>
<li>Primary B+-Tree index(equality on nonkey): B+树主索引，单值(非唯一)<ul>
<li>Cost: <span class="arithmatex">\(h_i*(t_T+t_S)+t_S+b*t_T\)</span>，其中b是包含查找值的数据块个数。</li>
</ul>
</li>
<li>Secondary B+-Tree index(equality on key): B+树辅助索引<ul>
<li>Cost: <span class="arithmatex">\((h_i+1)*(t_T+t_S)\)</span>，和B+树主索引搜索原理一样</li>
</ul>
</li>
<li>Secondary B+-index on nonkey: B+树辅助索引，单值v(非唯一)<ul>
<li>Cost: <span class="arithmatex">\((h_i + m+ n) * (t_T + t_S)\)</span></li>
<li>m指B+树中，对应查找值v索引的块的数量</li>
<li>n指包含查找值v的数据块的数量</li>
<li><img alt="" src="https://zerokei-imgurl.oss-cn-hangzhou.aliyuncs.com/img/20220613212054.png" /></li>
</ul>
</li>
</ul>
<h3 id="external-merge-sort">External Merge Sort</h3>
<ul>
<li>M: memory size，内存共可存放的页的个数</li>
<li>大致流程可以通过下图表示：<img alt="" src="https://zerokei-imgurl.oss-cn-hangzhou.aliyuncs.com/img/20220615202516.png" /><ul>
<li>第一轮传入M块数据，进行原地排序。（使用快排、堆排序等原地排序算法）</li>
<li>第二轮及后面每轮，合并M-1个有序序列。</li>
<li>注意，需要在memory块中预留一个区域存放排序好的有序序列，所以每轮合并后，有序序列的段数就少了M-1倍（预留出一个输出块的原因是：可以以块为单位写回，节省时间开销）</li>
</ul>
</li>
<li>block transfers<ul>
<li>Total number of merge passes required: <span class="arithmatex">\(\lceil \log_{M-1}(b_r/M)\rceil\)</span> (第一次排序被视为初始化，不计入其中，可带入检验<span class="arithmatex">\(b_r=M\)</span>和<span class="arithmatex">\(b_r=M-1\)</span>的情况)</li>
<li>因为在一轮归并排序中，一个块需要经历写入内存、然后写回磁盘，所以每轮的开销是 <span class="arithmatex">\(2b_r\)</span></li>
<li>最后一轮排序，不计算写回disk的开销。</li>
<li>所以总次数是<span class="arithmatex">\(b_r(2\lceil \log_{M-1}(b_r/M)\rceil + 1)\)</span></li>
</ul>
</li>
<li>seek times<ul>
<li>第一次排序：<span class="arithmatex">\(\lceil b_r/M\rceil\)</span> 次seek</li>
<li>第二次排序及后面的排序：假设每次读入/写出的块数为<span class="arithmatex">\(\lceil b_b \rceil\)</span> 则需要<span class="arithmatex">\(\lceil b_r/b_b\rceil\)</span>次读出和写入，此处共经历<span class="arithmatex">\(\lceil \log_{M-1}{(b_r/M)} \rceil\)</span>轮排序，最后一轮不用写入，故一共为<span class="arithmatex">\(\lceil b_r/b_b\rceil(2\lceil \log_{M-1}{(b_r/M)} \rceil -1)\)</span>次seek</li>
<li>总计为<span class="arithmatex">\(2\lceil b_r/M \rceil + \lceil b_r/b_b\rceil(2\lceil \log_{M-1}{(b_r/M)} \rceil -1)\)</span></li>
</ul>
</li>
</ul>
<h3 id="join">Join</h3>
<p>(1) Nested-Loop Join
<span class="arithmatex">\(r\bowtie_\theta s\)</span>，伪代码如下：</p>
<div class="highlight"><pre><span></span><code>for each tuple tr in r do begin
    for each tuple ts in s do begin
        test pair (tr, ts) to see if they satisfy the join condition
        if they do, add tr·ts to the result
    end
end
</code></pre></div>
<ul>
<li>最坏情况（只能载入两个block，r/s各一个）<ul>
<li>block transfers: <span class="arithmatex">\(b_r+n_r*b_s\)</span><ul>
<li>r共要载入<span class="arithmatex">\(b_r\)</span>次，而s共要载入<span class="arithmatex">\(n_r*b_s\)</span>次</li>
</ul>
</li>
<li>seek times: <span class="arithmatex">\(b_r+n_r\)</span><ul>
<li>r共要seek <span class="arithmatex">\(b_r\)</span>次，而s共要seek <span class="arithmatex">\(n_r\)</span>次</li>
</ul>
</li>
</ul>
</li>
<li>最好情况（全部元组都能直接载入内存）<ul>
<li>block transfers <span class="arithmatex">\(b_r + b_s\)</span></li>
<li>seek times: <span class="arithmatex">\(2\)</span></li>
</ul>
</li>
</ul>
<p>(2) Block Nested-Loop Join</p>
<div class="highlight"><pre><span></span><code>for each block Br in r do begin
    for each block Bs in s do begin
        for each tuple tr in Br do begin
            for each tuple ts in Bs do begin
                test pair (tr, ts) to see if they satisfy the join condition
                if they do, add tr·ts to the result
            end
        end
    end
end
</code></pre></div>
<ul>
<li>最坏情况（只能载入两个block，r/s各一个）<ul>
<li>block transfers: <span class="arithmatex">\(b_r+b_r*b_s\)</span><ul>
<li>r共要载入<span class="arithmatex">\(b_r\)</span>次，而s共要载入<span class="arithmatex">\(b_r*b_s\)</span>次</li>
</ul>
</li>
<li>seek times: <span class="arithmatex">\(2b_r\)</span><ul>
<li>r共要seek <span class="arithmatex">\(b_r\)</span>次，而s共要seek <span class="arithmatex">\(b_r\)</span>次</li>
</ul>
</li>
</ul>
</li>
<li>最好情况（全部元组都能直接载入内存）<ul>
<li>block transfers <span class="arithmatex">\(b_r + b_s\)</span></li>
<li>seek times: <span class="arithmatex">\(2\)</span></li>
</ul>
</li>
</ul>
<p>(3) Indexed Nested-Loop Join</p>
<ul>
<li>原理：外层遍历tuple(每次读取一个block)，内层使用索引匹配（如B+树索引等）</li>
<li>最坏情况（只能载入两个block，r/s各一个）</li>
<li>因为索引本身的复杂度较复杂，故只给出较粗略的估算<span class="arithmatex">\(b_r*(t_T+t_S)+n_r*c\)</span><ul>
<li>其中<span class="arithmatex">\(c\)</span>指单次查询的平均开销</li>
</ul>
</li>
</ul>
<p>(4) Merge-Join</p>
<ul>
<li>算法流程<ol>
<li>根据index的attributes进行排序</li>
<li>连接两个排序过的表（从头到尾扫描）</li>
</ol>
</li>
<li>理想情况下（每个块只需要读进内存一次）<ul>
<li>block transfers: <span class="arithmatex">\(b_r + b_s\)</span> +(排序)</li>
<li>seek times: <span class="arithmatex">\(\lceil b_r/b_b\rceil + \lceil b_s/b_b\rceil\)</span> +(排序)</li>
</ul>
</li>
</ul>
<p>(5) Hash-Join</p>
<p>大致流程如下</p>
<div class="highlight"><pre><span></span><code>将r划分成nh个块
将s划分成nh个块

for 0 to nh-1
    对r对应块中的元素建立索引Ri
    for 遍历s对应块中的元素
        检索索引Ri
        for 所有匹配的tuple in r
            join
        end
    end
end
</code></pre></div>
<p>假设r,s分别被划分了<span class="arithmatex">\(n_r,n_s\)</span>个块，但当<span class="arithmatex">\(n_r,n_s&gt;M\)</span>超过内存的容纳空间时，则需要进行递归划分。</p>
<ul>
<li>若没有递归划分<ul>
<li>block transfer: <span class="arithmatex">\(3(b_r+b_s)+4n_h\)</span><ul>
<li>划分过程需要遍历表，包含读出和写回 <span class="arithmatex">\(2*(b_r+b_s)\)</span></li>
<li>匹配过程需要遍历表，只包含读出 <span class="arithmatex">\(b_r+b_s\)</span></li>
<li>但是若Hash表非满，则至多制造出<span class="arithmatex">\(n_h\)</span>个非满块，涉及划分的写回和匹配的读出，作用于两个表，故共<span class="arithmatex">\(4n_h\)</span> (实际中<span class="arithmatex">\(n_h\)</span>一般很小，可以忽略不计)</li>
</ul>
</li>
<li>seek times: <span class="arithmatex">\(2(\lceil b_r/b_b\rceil +\lceil b_s/b_b\rceil)+2n_h\)</span><ul>
<li>划分过程需要遍历表，假设每次放入内存块中<span class="arithmatex">\(b_b\)</span>个，则读出写回共需<span class="arithmatex">\(2(\lceil b_r/b_b\rceil +\lceil b_s/b_b\rceil)\)</span>次</li>
<li>匹配过程中直接取Hash块，共<span class="arithmatex">\(2n_h\)</span></li>
</ul>
</li>
</ul>
</li>
<li>若有递归划分<ul>
<li>递归划分的原则是，每次将划分的大小降为原来的<span class="arithmatex">\(M-1\)</span>，直至每个划分的最多占<span class="arithmatex">\(M\)</span>块为止（使得内存能够容纳下，以便于建立索引）</li>
<li>block transfer: <span class="arithmatex">\(2(b_r+b_s)\lceil log_{M-1}(b_s)-1\rceil+b_r+b_s\)</span><ul>
<li>共进行<span class="arithmatex">\(\lceil log_{M-1}(b_s)-1\rceil\)</span>轮</li>
<li>其余参照没有递归划分的情况</li>
</ul>
</li>
<li>seek times: <span class="arithmatex">\(2(\lceil b_r/b_b\rceil +\lceil b_s/b_b\rceil)\lceil log_{M-1}(b_s)-1\rceil+2n_h\)</span><ul>
<li>共进行<span class="arithmatex">\(\lceil log_{M-1}(b_s)-1\rceil\)</span>轮</li>
<li>其余参照没有递归划分的情况</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="evaluation">Evaluation</h2>
<p>对一些单操作的复杂度有了解之后，可以使用物化(Materialization)和流水(pipelining)的方法将他们串起来</p>
<ul>
<li>实体化：依次进行表达式的计算，构建前缀树递归进行</li>
<li>流水线：同时评估多个操作</li>
</ul>
<h2 id="optimization">Optimization</h2>
<h3 id="equivalence-rule">Equivalence Rule(等价关系表达式)</h3>
<ol>
<li>Conjunctive selection operations can be deconstructed into a sequence of indicidual selections <span class="arithmatex">\(\sigma_{\theta_1\land\theta_2}(E)=\sigma_{\theta_1}(\sigma_{\theta_2}(E))\)</span></li>
<li>Selection operations are commutative <span class="arithmatex">\(\sigma_{\theta_1}(\sigma_{\theta_2}(E)) = \sigma_{\theta_2}(\sigma_{\theta_1}(E))\)</span></li>
<li>Only the last in a sequence of projection operations is needed, the others can be ommitted.<span class="arithmatex">\(\Pi_{L_1}(\Pi_{L_2}(...(\Pi_{L_n}(E))...))=\Pi_{L_1}(E)\)</span></li>
<li>Selections can be combined with Cartesian products and theta joins.
        (1) <span class="arithmatex">\(\sigma_{\theta}(E_1\times E_2) = E_1 \bowtie_\theta E_2\)</span>
        (2) <span class="arithmatex">\(\sigma_{\theta_1}(E_1\bowtie_{\theta_2} E_2)=E_1\bowtie_{\theta_1\land\theta_2}E_2\)</span></li>
<li>Theta-join operations (and natural joins) are commutative.<span class="arithmatex">\(E_1\bowtie_\theta E_2 = E_2\bowtie_\theta E_1\)</span></li>
<li>Natural join operatins are associative <span class="arithmatex">\((E_1\bowtie E_2)\bowtie E_3 = E_1\bowtie(E_2\bowtie E_3)\)</span>, Theta joins are associative in the following manner <span class="arithmatex">\((E_1\bowtie_{\theta_1} E_2)\bowtie_{\theta_2\land\theta_3} E_3 = E_1\bowtie_{\theta_1\land \theta_3}(E_2\bowtie_{\theta_2} E_3)\)</span>, where <span class="arithmatex">\(theta_2\)</span> involves attributes from only <span class="arithmatex">\(E_2\)</span> and <span class="arithmatex">\(E_3\)</span>.</li>
<li>The selection operation distributes over the theta join operation under the following two conditions:
        (1) When all the attributes in <span class="arithmatex">\(\theta_0\)</span> involve only the attributes of one of the expressions (<span class="arithmatex">\(E_1\)</span>) being joined <span class="arithmatex">\(\sigma_{\theta_0}(E_1\bowtie_{\theta}E_2)=(\sigma_{\theta_0}(E_1))\bowtie_\theta E_2\)</span>
        (2) When <span class="arithmatex">\(\theta_1\)</span> involves only the attributes of <span class="arithmatex">\(E_1\)</span> and <span class="arithmatex">\(\theta_2\)</span> involves only the attributes of <span class="arithmatex">\(E_2\)</span>. <span class="arithmatex">\(\sigma_{\theta_1\land \theta_2}(E_1\bowtie_{\theta}E_2)=(\sigma_{\theta_1}(E_1))\bowtie_{\theta}(\sigma_{\theta_2}(E_2))\)</span></li>
<li>The projetion operation distributes over the theta join operation as follows:
        (1) if <span class="arithmatex">\(\theta\)</span> involves only attributes from <span class="arithmatex">\(L_1 \cup L2\)</span>: <span class="arithmatex">\(\Pi_{L1\cup L_2}(E_1\bowtie_{\theta}E_2)=(\Pi_{L_1}(E_1))\bowtie_{\theta}(\Pi_{L_2}(E_2))\)</span>
        (2) Consider a join <span class="arithmatex">\(E_1\bowtie_\theta E_2\)</span>.
        (3) Let <span class="arithmatex">\(L_1\)</span> and <span class="arithmatex">\(L_2\)</span> be sets of attributes from <span class="arithmatex">\(E_1\)</span> and <span class="arithmatex">\(E_2\)</span> respectively
        (4) Let <span class="arithmatex">\(L_3\)</span> be attributes of <span class="arithmatex">\(E_1\)</span> that are involved in join condition <span class="arithmatex">\(\theta\)</span>, but are not in <span class="arithmatex">\(L_1 \cup L_2\)</span>
        (5) Let <span class="arithmatex">\(L_4\)</span> be attributes of <span class="arithmatex">\(E_2\)</span> that are involved in join condition <span class="arithmatex">\(\theta\)</span>, but are not in <span class="arithmatex">\(L_1\cup L_2\)</span>
        <span class="arithmatex">\(\Pi_{L_1\cup L_2}(E_1\bowtie_\theta E_2)=\Pi_{L_1\cup L_2}((\Pi_{L_1\cup L_3}(E_1))\bowtie_\theta(\Pi_{L2\cup L_4}(E_2)))\)</span></li>
<li>The set operations union and intersection are commutative <span class="arithmatex">\(E_1 \cup E_2 = E_2 \cup E_1\)</span>, <span class="arithmatex">\(E_1\cap E_2 = E_2 \cap E_1\)</span></li>
<li>Set union and intersection are assocative <span class="arithmatex">\((E_1\cup E_2)\cup E_3 = E_1 \cup (E_2\cup E_3)\)</span>, <span class="arithmatex">\((E_1\cap E_2)\cap E_3=E_1\cap(E_2\cap E_3)\)</span></li>
<li>The selection operation distributes over <span class="arithmatex">\(\cap\)</span>, <span class="arithmatex">\(\cup\)</span> and <span class="arithmatex">\(-\)</span> <span class="arithmatex">\(\sigma_\theta(E_1-E_2)=\sigma_\theta(E_1)-\sigma_\theta(E_2)\)</span></li>
<li>The projection operation distributes over union <span class="arithmatex">\(\Pi_{L}(E_1\cup E_2)=(\Pi_L(E_1))\cup (\Pi_{L}(E_2))\)</span></li>
</ol>
<h3 id="cost-estimation">Cost Estimation(结果集大小估计)</h3>
<ul>
<li>基本概念<ul>
<li><span class="arithmatex">\(n_r\)</span>: number of tuples in a relation <span class="arithmatex">\(r\)</span></li>
<li><span class="arithmatex">\(b_r\)</span>: number of blocks containing tuples of <span class="arithmatex">\(r\)</span></li>
<li><span class="arithmatex">\(l_r\)</span>: size of a tuple of <span class="arithmatex">\(r\)</span></li>
<li><span class="arithmatex">\(f_r\)</span>: blocking factor of <span class="arithmatex">\(r\)</span></li>
<li><span class="arithmatex">\(V(A,r)\)</span>: number of distinct values that appear in <span class="arithmatex">\(r\)</span> for attribute <span class="arithmatex">\(A\)</span>; same as the size of <span class="arithmatex">\(\Pi_A(r)\)</span></li>
<li><span class="arithmatex">\(b_r=\lceil \frac{n_r}{f_r} \rceil\)</span></li>
</ul>
</li>
<li>算法估计<ul>
<li>选择估计<span class="arithmatex">\(\sigma_{A=v}(r)\)</span><ul>
<li>一般假设为均匀分布</li>
<li><span class="arithmatex">\(n_r/V(A,r)\)</span></li>
</ul>
</li>
<li>复杂选择估计<ul>
<li>合取<span class="arithmatex">\(\sigma_{\theta_1\land \theta_2\land\dots\land\theta_n(r)}\)</span>: <span class="arithmatex">\(n_r\cdot\frac{s_1\cdot s_2\dots s_n}{n_r^n}\)</span></li>
<li>析取<span class="arithmatex">\(\sigma_{\theta_1\lor \theta_2\lor\dots\lor\theta_n(r)}\)</span>: <span class="arithmatex">\(n_r\cdot(1-(1-\frac{s_1}{n_r})(1-\frac{s_2}{n_r})\dots(1-\frac{s_n}{n_r}))\)</span></li>
</ul>
</li>
<li>
<p>连接估计<span class="arithmatex">\(r\bowtie s\)</span></p>
<ul>
<li>
<p>若两个关系无共同属性: <span class="arithmatex">\(n_r · n_s\)</span></p>
</li>
<li>
<p>若共同属性是r的key: <span class="arithmatex">\({\rm size} \le n_s\)</span> <img alt="" src="https://zerokei-imgurl.oss-cn-hangzhou.aliyuncs.com/img/20220616100956.png" /></p>
</li>
<li>
<p>若共同属性是s到r的foregin key: <span class="arithmatex">\(n_s\)</span><img alt="" src="https://zerokei-imgurl.oss-cn-hangzhou.aliyuncs.com/img/20220616101006.png" /></p>
</li>
<li>
<p>若共同属性不是key: <span class="arithmatex">\(\min(\frac{n_s\cdot n_r}{V(A,s)}, \frac{n_s\cdot n_r}{V(A,r)})\)</span><img alt="" src="https://zerokei-imgurl.oss-cn-hangzhou.aliyuncs.com/img/20220616101205.png" /></p>
<ul>
<li>投影: <span class="arithmatex">\(\Pi(s)\)</span>: <span class="arithmatex">\(V(A,r)\)</span></li>
<li>聚合: <span class="arithmatex">\(\mathcal{G}(s)\)</span>: <span class="arithmatex">\(V(A,r)\)</span></li>
<li>集合：转换为合取和析取</li>
</ul>
</li>
<li>Heuristic Optimization 探索式的优化<ul>
<li>尽早进行selection</li>
<li>尽早进行projection</li>
<li>选择最严格的selection和operations操作</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 - 2022 Zerokei
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="mailto:chritch-7@outlook.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/Zerokei" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>